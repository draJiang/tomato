(()=>{var e={665:function(e,t,s){"use strict";var a=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))((function(r,n){function o(e){try{g(a.next(e))}catch(e){n(e)}}function i(e){try{g(a.throw(e))}catch(e){n(e)}}function g(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,i)}g((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(93150)),o=s(329),i=s(65928),g=s(39397),l=s(19446),m=s(329);n.default.runtime.onInstalled.addListener((function(){}));let c,A,d,u,p,x=g.Status.Standby,f=0,b=0;function h(){n.default.tabs.query({active:!0,currentWindow:!0}).then((e=>a(this,void 0,void 0,(function*(){if(e[0]){A=e[0].id,c="url"in e[0]?e[0].url:e[0].pendingUrl;const t=(yield(0,o.checkWebsite)(c)).type;switch(console.log("当前状态："+x+"；当前网页："+t),t){case g.WebsiteType.White:switch(w(!1),x){case g.Status.Standby:case g.Status.Earn:break;case g.Status.Spend:n.default.storage.local.set({spendTime:b}),v(),x=g.Status.Standby}break;case g.WebsiteType.Black:switch(x){case g.Status.Standby:case g.Status.Earn:w(!0);break;case g.Status.Spend:w(!1)}break;case g.WebsiteType.Other:switch(x){case g.Status.Standby:w(!1);break;case g.Status.Earn:w(!0);break;case g.Status.Spend:n.default.action.setBadgeText({text:""}),n.default.storage.local.set({spendTime:b}),v(),x=g.Status.Standby}}}}))))}function y(e){return a(this,void 0,void 0,(function*(){if(A){let t=e;if(t+=1e3,t>=g.TomatoTime.Earn&&(console.log("🍅🍅🍅"),"Spend"===x?(T(-1),setTimeout((()=>{w(!0)}),400),n.default.storage.local.set({spendTime:0})):(T(1),n.default.tabs.sendMessage(A,{type:"completeTomato",data:{}})),v(),x=g.Status.Standby,t=0),p){g.TomatoTime.Earn;const e={type:"updateStatus",data:{websiteType:(yield(0,o.checkWebsite)(c)).type,status:x,timeSpent:t}};try{p.postMessage(e)}catch(e){console.log("error:"),console.log(e),e.message.indexOf("disconnected")>=0&&(p=void 0)}}if(0!==t){const e=g.TomatoTime.Earn-t;let s=(0,i.millisecondsToTime)(e);n.default.tabs.sendMessage(A,{type:"updateTomato",data:{remainingTime:e}}),navigator.userAgent.indexOf("Firefox")>=0&&(s="00"===s.split(":")[0]?s.split(":")[1]:s.split(":")[0]),n.default.action.setBadgeText({text:s}),x===g.Status.Spend?(n.default.action.setBadgeBackgroundColor({color:l.theme.color.colorYellow}),n.default.action.setBadgeTextColor({color:"#000000"})):(n.default.action.setBadgeBackgroundColor({color:l.theme.token.colorPrimary}),n.default.action.setBadgeTextColor({color:"#ffffff"}))}return t}return 0}))}function v(){x===g.Status.Spend?(clearInterval(u),u=void 0,b=0):(clearInterval(d),d=void 0,f=0),n.default.action.setBadgeText({text:""}),A&&n.default.tabs.sendMessage(A,{type:"updateTomato",data:{remainingTime:0}})}function w(e){return a(this,void 0,void 0,(function*(){if(A){let t=yield n.default.storage.local.get({tomato:{total:0,balance:0}});const s=(yield(0,o.checkWebsite)(c)).type;let a={status:x,showMask:e,tomato:t.tomato,websiteType:s};n.default.tabs.sendMessage(A,{type:"showMask",data:a})}}))}function T(e){return a(this,void 0,void 0,(function*(){let t=yield n.default.storage.local.get({tomato:{total:0,balance:0},data:{earn:[],spent:[]}});"spend"in t.data&&("spent"in t.data?t.data.spent=t.data.spend.concat(t.data.spent):t.data.spent=t.data.spend,delete t.data.spend),console.log("data:"),console.log(t),(new Date).toISOString().split("T")[0],e>0&&(t.tomato.total=t.tomato.total+e),t.tomato.balance=t.tomato.balance+e;const s=Object.assign({},t.data),a=(0,m.getNewData)(s,e);if(console.log("newData:"),console.log(a),n.default.storage.local.set({tomato:t.tomato,data:a}),p){const e={type:"updateTomatos",data:{status:g.Status.Standby,timeSpent:"Spend"===x?b:f,tomato:t.tomato}};p.postMessage(e)}}))}n.default.runtime.onMessage.addListener((function(e,t,s){if(console.log("Message from the content script: "+e.type),"newTomato"===e.type&&(d=setInterval((()=>a(this,void 0,void 0,(function*(){f=yield y(f),console.log(`EarnTomato has been viewed for ${f} ms.`)}))),1e3),x=g.Status.Earn,w(!1)),"stopTomato"===e.type&&(v(),x=g.Status.Standby,p)){const e={type:"updateStatus",data:{status:x,timeSpent:x===g.Status.Spend?b:f}};p.postMessage(e)}if("validate"===e.type)return(0,m.validate)(e.data.key).then((e=>{console.log(e),A&&n.default.tabs.sendMessage(A,{type:"validate",data:e})})),!0;"check"===e.type&&h(),"spendTomatos"===e.type&&(x===g.Status.Earn&&v(),x=g.Status.Spend,w(!1),n.default.storage.local.get({spendTime:0}).then((e=>{b=e.spendTime,u=setInterval((()=>a(this,void 0,void 0,(function*(){b=yield y(b),console.log(`spendzTomato has been viewed for ${b} ms.`)}))),1e3)})))})),n.default.runtime.onConnect.addListener((e=>{console.log("连接中------------"),"fromContentScript"===e.name||(p=e),"fromPopup"===e.name&&e.onMessage.addListener((t=>a(void 0,void 0,void 0,(function*(){if(console.log(t),"getStatus"===t.type){const t=(yield(0,o.checkWebsite)(c)).type;let s=yield n.default.storage.local.get({tomato:{total:0,balance:0}});const a={type:"Initialization",data:{websiteType:t,status:x,timeSpent:"Spend"===x?b:f,tomato:s.tomato}};e.postMessage(a)}}))))})),n.default.tabs.query({active:!0,currentWindow:!0}).then((e=>{console.log("初始化活动标签的状态"),e[0]&&(A=e[0].id,c=e[0].url,console.log(c),h())})),n.default.windows.onFocusChanged.addListener((function(e){console.log("browser.windows.onFocusChanged"),e!==n.default.windows.WINDOW_ID_NONE&&h()})),n.default.tabs.onActivated.addListener((function(e){console.log("browser.tabs.onActivated"),console.log(e),A=e.tabId,h()}))},329:function(e,t,s){"use strict";var a=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))((function(r,n){function o(e){try{g(a.next(e))}catch(e){n(e)}}function i(e){try{g(a.throw(e))}catch(e){n(e)}}function g(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,i)}g((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getNewData=t.validate=t.checkWebsite=void 0;const n=s(39397),o=r(s(93150));t.checkWebsite=e=>a(void 0,void 0,void 0,(function*(){let t=n.WebsiteType.Other;const s=(yield o.default.storage.local.get({websites:[]})).websites||[];for(let a=0;a<s.length;a++)if(e){const r=s[a].url.replace(/http:\/\//g,"").replace(/https:\/\//g,"").replace(/www./g,"");if(e.indexOf(r)>=0){t=s[a].type===n.WebsiteType.White?n.WebsiteType.White:n.WebsiteType.Black;break}}return{type:t}})),t.validate=e=>new Promise(((t,s)=>{fetch("https://api.lemonsqueezy.com/v1/licenses/validate",{method:"POST",body:JSON.stringify({license_key:e}),headers:{"Content-Type":"application/json"}}).then((e=>{e.json().then((e=>{console.log(e),t(e)}))}))})),t.getNewData=(e,t)=>{console.log("oldData:"),console.log(e);let s=Object.assign({},e);const a=(new Date).toISOString().split("T")[0];if(t>0){let e=!1;for(let r=0;r<s.earn.length;r++)if(s.earn[r].date===a){s.earn[r].value+=t,e=!0;break}e||s.earn.push({date:a,value:t}),s.earn=s.earn.slice(-10)}else{let e=!1;for(let r=0;r<s.spent.length;r++)if(s.spent[r].date===a){s.spent[r].value+=Math.abs(t),e=!0;break}e||s.spent.push({date:a,value:Math.abs(t)}),s.spent=s.spent.slice(-10)}return s}},39397:(e,t)=>{"use strict";var s,a,r;Object.defineProperty(t,"__esModule",{value:!0}),t.TomatoTime=t.WebsiteType=t.Status=void 0,(r=t.Status||(t.Status={})).Standby="Standby",r.Earn="Earn",r.Spend="Spend",(a=t.WebsiteType||(t.WebsiteType={})).Other="other",a.White="white",a.Black="black",(s=t.TomatoTime||(t.TomatoTime={}))[s.Earn=15e5]="Earn",s[s.Spend=15e5]="Spend"},19446:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.theme=void 0,t.theme={token:{colorPrimary:"#EF4B3A",colorLink:"#F08A24",colorLinkHover:"#ffa28f",colorLinkActive:"#c93126"},color:{colorSecond:"#A2C975",colorYellow:"#F8D772"}}},65928:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.millisecondsToTime=void 0,t.millisecondsToTime=function(e){let t=Math.floor(e/6e4).toString(),s=(e%6e4/1e3).toFixed(0).toString();return t=String(t).padStart(2,"0"),s=String(s).padStart(2,"0"),`${t}:${s}`}},93150:function(e,t){var s,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,s=function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(void 0===globalThis.browser||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const t="The message port closed before a response was received.",s=e=>{const s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(s).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class a extends WeakMap{constructor(e,t=undefined){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const r=(t,s)=>(...a)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):s.singleCallbackArg||a.length<=1&&!1!==s.singleCallbackArg?t.resolve(a[0]):t.resolve(a)},n=e=>1==e?"argument":"arguments",o=(e,t,s)=>new Proxy(t,{apply:(t,a,r)=>s.call(a,e,...r)});let i=Function.call.bind(Object.prototype.hasOwnProperty);const g=(e,t={},s={})=>{let a=Object.create(null),l={has:(t,s)=>s in e||s in a,get(l,m,c){if(m in a)return a[m];if(!(m in e))return;let A=e[m];if("function"==typeof A)if("function"==typeof t[m])A=o(e,e[m],t[m]);else if(i(s,m)){let t=((e,t)=>function(s,...a){if(a.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${n(t.minArgs)} for ${e}(), got ${a.length}`);if(a.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${n(t.maxArgs)} for ${e}(), got ${a.length}`);return new Promise(((n,o)=>{if(t.fallbackToNoCallback)try{s[e](...a,r({resolve:n,reject:o},t))}catch(r){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,r),s[e](...a),t.fallbackToNoCallback=!1,t.noCallback=!0,n()}else t.noCallback?(s[e](...a),n()):s[e](...a,r({resolve:n,reject:o},t))}))})(m,s[m]);A=o(e,e[m],t)}else A=A.bind(e);else if("object"==typeof A&&null!==A&&(i(t,m)||i(s,m)))A=g(A,t[m],s[m]);else{if(!i(s,"*"))return Object.defineProperty(a,m,{configurable:!0,enumerable:!0,get:()=>e[m],set(t){e[m]=t}}),A;A=g(A,t[m],s["*"])}return a[m]=A,A},set:(t,s,r,n)=>(s in a?a[s]=r:e[s]=r,!0),defineProperty:(e,t,s)=>Reflect.defineProperty(a,t,s),deleteProperty:(e,t)=>Reflect.deleteProperty(a,t)},m=Object.create(e);return new Proxy(m,l)},l=e=>({addListener(t,s,...a){t.addListener(e.get(s),...a)},hasListener:(t,s)=>t.hasListener(e.get(s)),removeListener(t,s){t.removeListener(e.get(s))}}),m=new a((e=>"function"!=typeof e?e:function(t){const s=g(t,{},{getContent:{minArgs:0,maxArgs:0}});e(s)})),c=new a((e=>"function"!=typeof e?e:function(t,s,a){let r,n,o=!1,i=new Promise((e=>{r=function(t){o=!0,e(t)}}));try{n=e(t,s,r)}catch(e){n=Promise.reject(e)}const g=!0!==n&&((l=n)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==n&&!g&&!o)return!1;return(g?n:i).then((e=>{a(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",a({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),A=({reject:s,resolve:a},r)=>{e.runtime.lastError?e.runtime.lastError.message===t?a():s(new Error(e.runtime.lastError.message)):r&&r.__mozWebExtensionPolyfillReject__?s(new Error(r.message)):a(r)},d=(e,t,s,...a)=>{if(a.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${n(t.minArgs)} for ${e}(), got ${a.length}`);if(a.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${n(t.maxArgs)} for ${e}(), got ${a.length}`);return new Promise(((e,t)=>{const r=A.bind(null,{resolve:e,reject:t});a.push(r),s.sendMessage(...a)}))},u={devtools:{network:{onRequestFinished:l(m)}},runtime:{onMessage:l(c),onMessageExternal:l(c),sendMessage:d.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:d.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},p={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":p},services:{"*":p},websites:{"*":p}},g(e,u,s)};e.exports=s(chrome)}else e.exports=globalThis.browser},void 0===(a=s.apply(t,[e]))||(e.exports=a)}},t={};!function s(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}(665)})();